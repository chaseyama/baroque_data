ad_dict = [ {
  "ad" : {
    "adsUserData" : {
      "adImpressions" : {
        "impressions" : [ {
          "deviceInfo" : {
            "osType" : "Desktop"
          },
          "displayLocation" : "TimelineHome",
          "promotedTweetInfo" : {
            "tweetId" : "1142911342216646663",
            "tweetText" : "We know you are up to the challenge. Come join our team!",
            "urls" : [ ],
            "mediaUrls" : [ ]
          },
          "advertiserInfo" : {
            "advertiserName" : "Monster",
            "screenName" : "@Monster"
          },
          "matchedTargetingCriteria" : [ {
            "targetingType" : "Interests",
            "targetingValue" : "Tech news"
          }, {
            "targetingType" : "Locations",
            "targetingValue" : "California"
          } ],
          "impressionTime" : "2019-07-06 02:26:43"
        }, {
          "deviceInfo" : {
            "osType" : "Desktop"
          },
          "displayLocation" : "TimelineHome",
          "promotedTweetInfo" : {
            "tweetId" : "1095979754086371329",
            "tweetText" : "Penny showed more than intended in her senior year photo",
            "urls" : [ ],
            "mediaUrls" : [ ]
          },
          "advertiserInfo" : {
            "advertiserName" : "Worldation",
            "screenName" : "@Worldation_com"
          },
          "matchedTargetingCriteria" : [ {
            "targetingType" : "Languages",
            "targetingValue" : "English"
          }, {
            "targetingType" : "Locations",
            "targetingValue" : "United States"
          }, {
            "targetingType" : "Platforms",
            "targetingValue" : "Desktop"
          } ],
          "impressionTime" : "2019-07-06 02:26:43"
        }, {
          "deviceInfo" : {
            "osType" : "Desktop"
          },
          "displayLocation" : "WtfSidebar",
          "advertiserInfo" : {
            "advertiserName" : "Amazon Prime Video US",
            "screenName" : "@PrimeVideo"
          },
          "matchedTargetingCriteria" : [ {
            "targetingType" : "Locations",
            "targetingValue" : "United States"
          } ],
          "impressionTime" : "2019-07-06 02:26:12"
        }, {
          "deviceInfo" : {
            "osType" : "Desktop"
          },
          "displayLocation" : "TimelineHome",
          "promotedTweetInfo" : {
            "tweetId" : "1146509651078344704",
            "tweetText" : "Meet the Men Carrying on Dario Pegoretti's Legacy https://t.co/2gKBMMGdp7",
            "urls" : [ ],
            "mediaUrls" : [ "https://t.co/2gKBMMGdp7" ]
          },
          "publisherInfo" : {
            "publisherName" : "Bicycling Magazine",
            "screenName" : "@BicyclingMag"
          },
          "advertiserInfo" : {
            "advertiserName" : "Voxsup",
            "screenName" : "@voxsup"
          },
          "matchedTargetingCriteria" : [ {
            "targetingType" : "Locations",
            "targetingValue" : "United States"
          } ],
          "impressionTime" : "2019-07-06 02:26:43"
        }, {
          "deviceInfo" : {
            "osType" : "Desktop"
          },
          "displayLocation" : "TimelineHome",
          "promotedTweetInfo" : {
            "tweetId" : "1147082742854803457",
            "tweetText" : "“The LORD will be king over the whole earth. On that day there will be one LORD, and his name the only name.”\nZechariah 14:9",
            "urls" : [ ],
            "mediaUrls" : [ ]
          },
          "advertiserInfo" : {
            "advertiserName" : "ISIK ABLA- OFFICIAL",
            "screenName" : "@Isikablatv"
          },
          "matchedTargetingCriteria" : [ {
            "targetingType" : "Interests",
            "targetingValue" : "Animation"
          }, {
            "targetingType" : "Locations",
            "targetingValue" : "United States"
          } ],
          "impressionTime" : "2019-07-06 02:26:43"
        }, {
          "deviceInfo" : {
            "osType" : "Desktop"
          },
          "displayLocation" : "TimelineHome",
          "promotedTweetInfo" : {
            "tweetId" : "1125279237076811776",
            "tweetText" : "“When you undertake two transformations at the same time, it is impossible to succeed with either. There is no such thing as two top priorities. There can only be one.” ~ Geoffrey A. Moore\n\nRP @omelnikov #Acronis #CyberProtection #MotivationMonday https://t.co/hKcSDAY3ft",
            "urls" : [ ],
            "mediaUrls" : [ "https://t.co/hKcSDAY3ft" ]
          },
          "advertiserInfo" : {
            "advertiserName" : "Acronis",
            "screenName" : "@Acronis"
          },
          "matchedTargetingCriteria" : [ {
            "targetingType" : "Interests",
            "targetingValue" : "Computer reviews"
          }, {
            "targetingType" : "Interests",
            "targetingValue" : "Gaming news and general info"
          }, {
            "targetingType" : "Interests",
            "targetingValue" : "Tech news"
          }, {
            "targetingType" : "Interests",
            "targetingValue" : "Space and astronomy"
          }, {
            "targetingType" : "Interests",
            "targetingValue" : "Science news"
          }, {
            "targetingType" : "Locations",
            "targetingValue" : "United States"
          } ],
          "impressionTime" : "2019-07-06 02:26:43"
        }, {
          "deviceInfo" : {
            "osType" : "Desktop"
          },
          "displayLocation" : "TimelineHome",
          "promotedTweetInfo" : {
            "tweetId" : "1147122287537283074",
            "tweetText" : "Meet the first person to sing 'The Star-Spangled Banner' in all 50 states - #ICYMI @THEANTHEMGIRL from @foxnewsnight:\n\nhttps://t.co/6VxgoPnE6l",
            "urls" : [ "https://t.co/6VxgoPnE6l" ],
            "mediaUrls" : [ ]
          },
          "advertiserInfo" : {
            "advertiserName" : "Mike Emanuel \uD83C\uDDFA\uD83C\uDDF8",
            "screenName" : "@MikeEmanuelFox"
          },
          "matchedTargetingCriteria" : [ {
            "targetingType" : "Interests",
            "targetingValue" : "Sports news"
          }, {
            "targetingType" : "Interests",
            "targetingValue" : "Music news and general info"
          }, {
            "targetingType" : "Interests",
            "targetingValue" : "Animation"
          }, {
            "targetingType" : "Locations",
            "targetingValue" : "United States"
          } ],
          "impressionTime" : "2019-07-06 02:26:43"
        } ]
      }
    }
  }
}, {
  "ad" : {
    "adsUserData" : {
      "adImpressions" : {
        "impressions" : [ {
          "deviceInfo" : {
            "osType" : "Ios",
            "deviceId" : "2eVW2/fWZAazjwP/uvHAa4qkFW/vxfWcs2GVKmq/Lvo=",
            "deviceType" : "iPhone XR"
          },
          "displayLocation" : "TimelineHome",
          "promotedTweetInfo" : {
            "tweetId" : "1172253552544116737",
            "tweetText" : "To celebrate #NationalVideoGamesDay and the release of NBA 2K20, check out the recap of @LavishPhenom's matchup with @TimbersFC eMLS player @RCTID_Thiago! https://t.co/layFhe1bS4",
            "urls" : [ ],
            "mediaUrls" : [ "https://t.co/layFhe1bS4" ]
          },
          "advertiserInfo" : {
            "advertiserName" : "Blazer5 Gaming",
            "screenName" : "@blazer5gaming"
          },
          "matchedTargetingCriteria" : [ {
            "targetingType" : "Interests",
            "targetingValue" : "Computer gaming"
          }, {
            "targetingType" : "Interests",
            "targetingValue" : "Online gaming"
          }, {
            "targetingType" : "Locations",
            "targetingValue" : "United States"
          } ],
          "impressionTime" : "2019-09-12 21:00:36"
        } ]
      }
    }
  }
} ]



attr = ["ad", "adsUserData", "adImpressions", "impressions",
        "matchedTargetingCriteria"]
interests = []

// loop through all ads
for (var i = 0; i < ad_dict.length; i++) {
    ad = ad_dict[i][attr[0]][attr[1]][attr[2]][attr[3]]

    // loop through all impressions
    for (var j = 0; j < ad.length; j++) {
        impression = ad[j][attr[4]]

        // loop through each attribute
        for (var k = 0; k < impression.length; k++) {
            if (impression[k]["targetingType"] == "Interests") {
                interests.push(impression[k]["targetingValue"])
            }
        }
    }
}

console.log(interests)

const fs = require('fs')

fs.writeFile('twitter_impressions.csv', interests, (err) => {

    // In case of a error throw err.
    if (err) throw err;
})

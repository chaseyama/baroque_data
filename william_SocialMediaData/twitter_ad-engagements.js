//window.YTD.ad_engagements.part0
ad_dict = [ {
  "ad" : {
    "adsUserData" : {
      "adEngagements" : {
        "engagements" : [ {
          "impressionAttributes" : {
            "deviceInfo" : {
              "osType" : "Desktop"
            },
            "displayLocation" : "TimelineHome",
            "promotedTweetInfo" : {
              "tweetId" : "1147082742854803457",
              "tweetText" : "“The LORD will be king over the whole earth. On that day there will be one LORD, and his name the only name.”\nZechariah 14:9",
              "urls" : [ ],
              "mediaUrls" : [ ]
            },
            "advertiserInfo" : {
              "advertiserName" : "ISIK ABLA- OFFICIAL",
              "screenName" : "@Isikablatv"
            },
            "matchedTargetingCriteria" : [ {
              "targetingType" : "Interests",
              "targetingValue" : "Animation"
            }, {
              "targetingType" : "Locations",
              "targetingValue" : "United States"
            } ],
            "impressionTime" : "2019-07-06 02:26:08"
          },
          "engagementAttributes" : [ {
            "engagementTime" : "2019-07-06 02:26:43",
            "engagementType" : "ChargeableImpression"
          } ]
        }, {
          "impressionAttributes" : {
            "deviceInfo" : {
              "osType" : "Desktop"
            },
            "displayLocation" : "TimelineHome",
            "promotedTweetInfo" : {
              "tweetId" : "1147122287537283074",
              "tweetText" : "Meet the first person to sing 'The Star-Spangled Banner' in all 50 states - #ICYMI @THEANTHEMGIRL from @foxnewsnight:\n\nhttps://t.co/6VxgoPnE6l",
              "urls" : [ "https://t.co/6VxgoPnE6l" ],
              "mediaUrls" : [ ]
            },
            "advertiserInfo" : {
              "advertiserName" : "Mike Emanuel \uD83C\uDDFA\uD83C\uDDF8",
              "screenName" : "@MikeEmanuelFox"
            },
            "matchedTargetingCriteria" : [ {
              "targetingType" : "Interests",
              "targetingValue" : "Sports news"
            }, {
              "targetingType" : "Interests",
              "targetingValue" : "Music news and general info"
            }, {
              "targetingType" : "Interests",
              "targetingValue" : "Animation"
            }, {
              "targetingType" : "Locations",
              "targetingValue" : "United States"
            } ],
            "impressionTime" : "2019-07-06 02:26:08"
          },
          "engagementAttributes" : [ {
            "engagementTime" : "2019-07-06 02:26:43",
            "engagementType" : "ChargeableImpression"
          } ]
        } ]
      }
    }
  }
}, {
  "ad" : {
    "adsUserData" : {
      "adEngagements" : {
        "engagements" : [ {
          "impressionAttributes" : {
            "deviceInfo" : {
              "osType" : "Ios",
              "deviceId" : "2eVW2/fWZAazjwP/uvHAa4qkFW/vxfWcs2GVKmq/Lvo="
            },
            "displayLocation" : "TimelineHome",
            "promotedTweetInfo" : {
              "tweetId" : "1172253552544116737",
              "tweetText" : "To celebrate #NationalVideoGamesDay and the release of NBA 2K20, check out the recap of @LavishPhenom's matchup with @TimbersFC eMLS player @RCTID_Thiago! https://t.co/layFhe1bS4",
              "urls" : [ ],
              "mediaUrls" : [ "https://t.co/layFhe1bS4" ]
            },
            "advertiserInfo" : {
              "advertiserName" : "Blazer5 Gaming",
              "screenName" : "@blazer5gaming"
            },
            "matchedTargetingCriteria" : [ {
              "targetingType" : "Interests",
              "targetingValue" : "Computer gaming"
            }, {
              "targetingType" : "Interests",
              "targetingValue" : "Online gaming"
            }, {
              "targetingType" : "Locations",
              "targetingValue" : "United States"
            } ],
            "impressionTime" : "2019-09-12 21:00:33"
          },
          "engagementAttributes" : [ {
            "engagementTime" : "2019-09-12 21:00:37",
            "engagementType" : "VideoContentMrcView"
          }, {
            "engagementTime" : "2019-09-12 21:00:38",
            "engagementType" : "VideoContentViewThreshold"
          }, {
            "engagementTime" : "2019-09-12 21:00:36",
            "engagementType" : "VideoContent1secView"
          }, {
            "engagementTime" : "2019-09-12 21:00:44",
            "engagementType" : "VideoSession"
          }, {
            "engagementTime" : "2019-09-12 21:00:36",
            "engagementType" : "ChargeableImpression"
          }, {
            "engagementTime" : "2019-09-12 21:00:38",
            "engagementType" : "VideoContentViewV2"
          }, {
            "engagementTime" : "2019-09-12 21:00:42",
            "engagementType" : "VideoContent6secView"
          }, {
            "engagementTime" : "2019-09-12 21:00:36",
            "engagementType" : "VideoContentPlaybackStart"
          } ]
        }, {
          "impressionAttributes" : {
            "deviceInfo" : {
              "osType" : "Ios",
              "deviceId" : "2eVW2/fWZAazjwP/uvHAa4qkFW/vxfWcs2GVKmq/Lvo="
            },
            "displayLocation" : "TimelineHome",
            "promotedTweetInfo" : {
              "tweetId" : "1172253552544116737",
              "tweetText" : "To celebrate #NationalVideoGamesDay and the release of NBA 2K20, check out the recap of @LavishPhenom's matchup with @TimbersFC eMLS player @RCTID_Thiago! https://t.co/layFhe1bS4",
              "urls" : [ ],
              "mediaUrls" : [ "https://t.co/layFhe1bS4" ]
            },
            "advertiserInfo" : {
              "advertiserName" : "Blazer5 Gaming",
              "screenName" : "@blazer5gaming"
            },
            "matchedTargetingCriteria" : [ {
              "targetingType" : "Interests",
              "targetingValue" : "Computer gaming"
            }, {
              "targetingType" : "Interests",
              "targetingValue" : "Online gaming"
            }, {
              "targetingType" : "Locations",
              "targetingValue" : "United States"
            } ],
            "impressionTime" : "2019-09-12 21:00:33"
          },
          "engagementAttributes" : [ {
            "engagementTime" : "2019-09-13 19:07:19",
            "engagementType" : "VideoContentViewV2"
          }, {
            "engagementTime" : "2019-09-13 19:07:47",
            "engagementType" : "VideoSession"
          } ]
        } ]
      }
    }
  }
} ]

// recency, frequency, engagement (visit duration)
// general info = $0.0007
attr = ["ad", "adsUserData", "adEngagements", "engagements",
        "impressionAttributes", "matchedTargetingCriteria"]
interests = []

// loop through all ads
for (var i = 0; i < ad_dict.length; i++) {
    ad = ad_dict[i][attr[0]][attr[1]][attr[2]][attr[3]]

    // loops through engagements
    for (var j = 0; j < ad.length; j++) {
        engagement = ad[j][attr[4]][attr[5]]

        // loop through each attribute
        for (var k = 0; k < engagement.length; k++) {
            if (engagement[k]["targetingType"] == "Interests") {
                interests.push(engagement[k]["targetingValue"])
            }
        }
    }
}

console.log(interests)

const fs = require('fs')

fs.writeFile('twitter_engagements.csv', interests, (err) => {

    // In case of a error throw err.
    if (err) throw err;
})
